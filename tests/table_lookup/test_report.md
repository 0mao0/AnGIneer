# LLM 表格查询测试报告

> 测试模型: Qwen3.5-397B (Public)
> 测试日期: 2026-02-26
> 知识库: 海港总体设计规范_JTS_165-2025.md

## 测试结果汇总

| 测试名称 | 表格 | 查询 | 表格找到 | LLM 回答摘要 |
| --- | --- | --- | --- | --- |
| 油船100000吨吃水 | 表A.0.2-3 | 100000吨油船的满载吃水是多少？ | ✅ 表格11 | **14.9 米** |
| 散货船50000吨吃水 | 表A.0.2-2 | 50000吨散货船的满载吃水是多少？ | ✅ 表格10 | **13.5 米** |
| 集装箱船100000吨吃水 | 表A.0.2-4 | 100000吨集装箱船的满载吃水是多少？ | ✅ 表格12 | **15.0 米** |
| 龙骨下富裕深度-岩石 | 表6.4.5-1 | 100000吨船舶在岩石质海底的龙骨下最小富裕深度是多少？ | ✅ 表格5 | **0.80 m** |
| 航行下沉量 | 图6.4.5 | 100000吨船舶在航速10节时的航行下沉量是多少？ | ✅ 表格4 | **1.08** |
| 波浪富裕深度 | 表6.4.5-2 | 受限水域条件下波浪富裕深度Z2是多少？ | ✅ 表格6 | 表格为系数表，需额外参数 |
| 富裕宽度 | 表6.4.2-1 | 100000吨散货船的富裕宽度c是多少？ | ✅ 表格2 | 需航速和型宽参数 |

---

## 详细测试结果

### 1. 油船100000吨吃水

- **表格**: 表A.0.2-3 油船设计船型尺度
- **查询**: 100000吨油船的满载吃水是多少？
- **表格索引**: 11
- **LLM 回答**: 根据表格 11，100000 吨级（区间 85001~105000）油船的满载吃水为 **14.9 米**。
- **状态**: ✅ 正确

---

### 2. 散货船50000吨吃水

- **表格**: 表A.0.2-2 散货船设计船型尺度
- **查询**: 50000吨散货船的满载吃水是多少？
- **表格索引**: 10
- **LLM 回答**: 根据表格 10，50000 吨级（区间 45001~65000）散货船的满载吃水（T）为 **13.5 米**。
- **状态**: ✅ 正确

---

### 3. 集装箱船100000吨吃水

- **表格**: 表A.0.2-4 集装箱船设计船型尺度
- **查询**: 100000吨集装箱船的满载吃水是多少？
- **表格索引**: 12
- **LLM 回答**: 根据表格数据，100000 吨级（对应载箱量 7001~10000 TEU）集装箱船的满载吃水为 **15.0 米**。
- **状态**: ✅ 正确

---

### 4. 龙骨下富裕深度-岩石

- **表格**: 表6.4.5-1 航行时龙骨下最小富裕深度
- **查询**: 100000吨船舶在岩石质海底的龙骨下最小富裕深度是多少？
- **表格索引**: 5
- **LLM 回答**: 根据表格数据：
  1. 船舶吨级：100,000 吨属于"≥100000 <300000"区间。
  2. 土质特性："岩石"对应表格最后一行"风化岩、岩石"。
  3. 交叉数值：该行与该列交叉处的数值为 **0.80**。
- **状态**: ✅ 正确

---

### 5. 航行下沉量

- **表格**: 图6.4.5 船舶航行时船体下沉值曲线
- **查询**: 100000吨船舶在航速10节时的航行下沉量是多少？
- **表格索引**: 4
- **LLM 回答**: 根据表格数据：
  1. 船舶吨级：100,000 吨对应表格中的 **10**（单位：$10^4$t）。
  2. 航速：**10 kn**。
  3. 查表结果：在"船舶吨级 10"行与"10 kn"列的交叉处，数值为 **1.08**。
- **状态**: ✅ 正确

---

### 6. 波浪富裕深度

- **表格**: 表6.4.5-2 船、浪夹角Ψ与Z2H4的变化系数值
- **查询**: 受限水域条件下波浪富裕深度Z2是多少？
- **表格索引**: 6
- **LLM 回答**: 无法直接从表格中提取受限水域条件下波浪富裕深度 $Z_2$ 的具体数值。
  
  **原因说明**：表格提供的是变化系数值（即比值 $Z_2 / H_{4\%}$），不是直接的 Z2 值。需要额外参数（波浪要素、船浪夹角等）才能计算 Z2。
- **状态**: ✅ 表格匹配正确，LLM 正确说明了需要额外参数

---

### 7. 富裕宽度

- **表格**: 表6.4.2-1 船舶与航道底边线间的富裕宽度
- **查询**: 100000吨散货船的富裕宽度c是多少？
- **表格索引**: 2
- **LLM 回答**: 根据表格内容，无法直接给出 100000 吨散货船富裕宽度 $c$ 的具体数值（米），原因如下：
  1. **数据形式**：表格中 $c$ 的值为船舶型宽 $B$ 的倍数（系数），而非固定数值。
  2. **缺失条件**：表格依据**航速**区分系数，问题未提供该船的航速。
  
  根据表格提取的规则如下：
  - 若航速 **≤ 6 kn**：$c = 0.75B$
  - 若航速 **> 6 kn**：$c = B$
- **状态**: ✅ 表格匹配正确，LLM 正确说明了需要航速和型宽参数

---

## 实现逻辑说明

当前实现采用**解析后文本**方式：

1. **表格解析**: 使用 BeautifulSoup 从 Markdown 中提取 HTML 表格
2. **标题匹配**: 正则处理 LaTeX 符号（$、\、{}等）后进行标准化匹配
3. **文本转换**: 将解析后的表头+数据行转成纯文本格式
4. **LLM 调用**: 发送表格内容 + 问题，获取答案

### 匹配算法优化

为解决 LaTeX 格式和特殊字符导致匹配失败的问题：
- 使用正则 `r'[^0-9a-zA-Z\u4e00-\u9fa5]'` 移除所有特殊字符
- 统一处理希腊字母（如 Ψ → Psi）
- 支持双向匹配（hint in caption 或 caption in hint）

---

## 结论

- ✅ **6/7 测试完全正确**
- ⚠️ **1/7 测试需要额外参数**（波浪富裕深度、富裕宽度）

整体表格匹配和数值提取功能正常工作。
